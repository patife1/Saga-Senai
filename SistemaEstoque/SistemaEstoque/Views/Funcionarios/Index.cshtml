@model IEnumerable<SistemaEstoque.Models.Funcionario>
@{
    ViewData["Title"] = "Funcionários";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-users me-2"></i>
                            Gerenciamento de Funcionários
                        </h4>
                        <a asp-action="Create" class="btn btn-light btn-sm">
                            <i class="fas fa-plus me-1"></i>
                            Novo Funcionário
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Filtros de Pesquisa -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" id="searchInput" class="form-control" placeholder="Buscar por nome, CPF ou cargo...">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select id="statusFilter" class="form-select">
                                <option value="">Todos os Status</option>
                                <option value="true">Ativos</option>
                                <option value="false">Inativos</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select id="cargoFilter" class="form-select">
                                <option value="">Todos os Cargos</option>
                                <option value="Gerente">Gerente</option>
                                <option value="Vendedor">Vendedor</option>
                                <option value="Estoquista">Estoquista</option>
                                <option value="Caixa">Caixa</option>
                                <option value="Administrador">Administrador</option>
                            </select>
                        </div>
                    </div>

                    <!-- Estatísticas Rápidas -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <h5>@Model.Count(f => f.Ativo)</h5>
                                    <small>Funcionários Ativos</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-danger text-white">
                                <div class="card-body text-center">
                                    <h5>@Model.Count(f => !f.Ativo)</h5>
                                    <small>Funcionários Inativos</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <h5>@Model.GroupBy(f => f.Cargo).Count()</h5>
                                    <small>Diferentes Cargos</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <h5>@(Model.Any() ? (DateTime.Now - Model.Min(f => f.DataAdmissao)).Days / 365 : 0)</h5>
                                    <small>Anos de Experiência</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabela de Funcionários -->
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="funcionariosTable">
                            <thead class="table-dark">
                                <tr>
                                    <th><i class="fas fa-user me-1"></i>Nome</th>
                                    <th><i class="fas fa-id-card me-1"></i>CPF</th>
                                    <th><i class="fas fa-briefcase me-1"></i>Cargo</th>
                                    <th><i class="fas fa-envelope me-1"></i>Email</th>
                                    <th><i class="fas fa-phone me-1"></i>Telefone</th>
                                    <th><i class="fas fa-calendar me-1"></i>Admissão</th>
                                    <th><i class="fas fa-dollar-sign me-1"></i>Salário</th>
                                    <th><i class="fas fa-toggle-on me-1"></i>Status</th>
                                    <th class="text-center"><i class="fas fa-cogs me-1"></i>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var funcionario in Model.OrderBy(f => f.Nome))
                                {
                                    <tr data-status="@funcionario.Ativo.ToString().ToLower()" data-cargo="@funcionario.Cargo" data-search="@($"{funcionario.Nome} {funcionario.CPF} {funcionario.Cargo}".ToLower())">
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <div class="avatar-sm bg-primary rounded-circle d-flex align-items-center justify-content-center text-white me-2">
                                                    @funcionario.Nome.First()
                                                </div>
                                                <strong>@funcionario.Nome</strong>
                                            </div>
                                        </td>
                                        <td>
                                            <code>@funcionario.CPF</code>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">@funcionario.Cargo</span>
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(funcionario.Email))
                                            {
                                                <a href="mailto:@funcionario.Email" class="text-decoration-none">
                                                    @funcionario.Email
                                                </a>
                                            }
                                            else
                                            {
                                                <span class="text-muted">Não informado</span>
                                            }
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(funcionario.Telefone))
                                            {
                                                <a href="tel:@funcionario.Telefone" class="text-decoration-none">
                                                    @funcionario.Telefone
                                                </a>
                                            }
                                            else
                                            {
                                                <span class="text-muted">Não informado</span>
                                            }
                                        </td>
                                        <td>
                                            <span title="@funcionario.DataAdmissao.ToString("dd/MM/yyyy")">
                                                @funcionario.DataAdmissao.ToString("dd/MM/yyyy")
                                            </span>
                                        </td>
                                        <td>
                                            <strong class="text-success">@(funcionario.Salario?.ToString("C") ?? "Não informado")</strong>
                                        </td>
                                        <td>
                                            @if (funcionario.Ativo)
                                            {
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check me-1"></i>Ativo
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-danger">
                                                    <i class="fas fa-times me-1"></i>Inativo
                                                </span>
                                            }
                                        </td>
                                        <td class="text-center">
                                            <div class="btn-group" role="group">
                                                <a asp-action="Details" asp-route-id="@funcionario.Id" 
                                                   class="btn btn-outline-info btn-sm" 
                                                   title="Ver Detalhes">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <a asp-action="Edit" asp-route-id="@funcionario.Id" 
                                                   class="btn btn-outline-warning btn-sm" 
                                                   title="Editar">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a asp-action="Delete" asp-route-id="@funcionario.Id" 
                                                   class="btn btn-outline-danger btn-sm" 
                                                   title="Excluir">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    @if (!Model.Any())
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-users fa-4x text-muted mb-3"></i>
                            <h5 class="text-muted">Nenhum funcionário cadastrado</h5>
                            <p class="text-muted">Clique no botão "Novo Funcionário" para começar.</p>
                            <a asp-action="Create" class="btn btn-primary">
                                <i class="fas fa-plus me-1"></i>
                                Cadastrar Primeiro Funcionário
                            </a>
                        </div>
                    }
                </div>
                <div class="card-footer text-muted">
                    <small>
                        <i class="fas fa-info-circle me-1"></i>
                        Total de @Model.Count() funcionário(s) cadastrado(s)
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .avatar-sm {
        width: 35px;
        height: 35px;
        font-size: 14px;
        font-weight: bold;
    }
    
    .table th {
        border-top: none;
        font-weight: 600;
    }
    
    .btn-group .btn {
        padding: 0.25rem 0.5rem;
    }
    
    .card {
        border: none;
        border-radius: 10px;
    }
    
    .table-hover tbody tr:hover {
        background-color: rgba(0, 123, 255, 0.05);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const cargoFilter = document.getElementById('cargoFilter');
        const table = document.getElementById('funcionariosTable');
        const rows = table.querySelectorAll('tbody tr');

        function filterTable() {
            const searchTerm = searchInput.value.toLowerCase();
            const statusValue = statusFilter.value;
            const cargoValue = cargoFilter.value;

            rows.forEach(row => {
                const searchText = row.getAttribute('data-search');
                const status = row.getAttribute('data-status');
                const cargo = row.getAttribute('data-cargo');

                const matchesSearch = searchText.includes(searchTerm);
                const matchesStatus = !statusValue || status === statusValue;
                const matchesCargo = !cargoValue || cargo === cargoValue;

                if (matchesSearch && matchesStatus && matchesCargo) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        searchInput.addEventListener('input', filterTable);
        statusFilter.addEventListener('change', filterTable);
        cargoFilter.addEventListener('change', filterTable);
    });
</script>
